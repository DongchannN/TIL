# Compute Service

## AMI

Amazon Machine Image(AMI)는 AWS에서 제공하는 이미지로, 인스턴스를 시작하는 데 필요한 정보를 제공함.

1. Amazon 퀵 스타트 AMI
    
    다양한 배포판을 기반으로 다양한 용도로 활용할 수 있는 인기높은 이미지.
    
2. AWS 마켓 플레이스 AMI
    
    Cisco와 같은 기업용 소프트웨어 벤더가 지원, 제공하는 이미지.
    
    **Cisco CSR 1000V (Cloud Services Router)**: 이 가상 라우터는 AWS에서 네트워크 라우팅을 제공하며, 물리적 Cisco 라우터와 동일한 기능을 수행함. 이는 온프레미스 라우터를 AWS 클라우드로 확장하는 데 유용함.
    
3. 커뮤니티 AMI
    
    AWS 사용자 커뮤니티나 독립적인 벤더에 의해 특수한 목적에 적합하도록 개발 및 배포됨. → 약간 이해 안됨.
    
4. 프라이빗 AMI
    
    본인이 직접 AMI를 만들어서 사용하는 것도 가능함.
    
    ## EC2 인스턴스 타입
    
    [Compute – Amazon EC2 Instance Types – AWS](http://aws.amazon.com/ec2/instance-types)
    
    1. 범용 인스턴스
        
        균형있는 컴퓨팅, 메모리, 네트워킹 리소스 제공 → 다양한 워크로드에서 사용할 수 있음.
        
        웹 서버 및 코드 리포지토리와 같이 이러한 리소스를 동등한 비율로 사용하는 애플리케이션에 적합.
        
        ![Screenshot 2024-07-16 at 5.32.02 PM.png](../Solutions%20Architect/img/Compute%20Service/Screenshot_2024-07-16_at_5.32.02_PM.png)
        
    2. 컴퓨팅 최적화
        
        **고성능 프로세서**를 활용하는 컴퓨팅 집약적인 애플리케이션에 적합. 
        
        ex) 배치 처리 워크로드, 미디어 트랜스코딩, 고성능 웹서버, 고성능 컴퓨팅(HPC), 과학적 모델링, 전용 게임 서버, 광고 서버 엔진, 기계학습 등.
        
        ![Screenshot 2024-07-16 at 5.34.17 PM.png](../Solutions%20Architect/img/Compute%20Service/Screenshot_2024-07-16_at_5.34.17_PM.png)
        
    3. 메모리 최적화
        
        메모리 최적화 인스턴스는 메모리에서 대규모 데이터 세트를 처리하는 워크로드를 위한 빠른 성능을 제공하기 위해 설계.
        
        ex) 고성능 데이터베이스, 실시간 빅데이터 분석, 인 메모리 캐시 등.
        
        ![Screenshot 2024-07-16 at 5.37.45 PM.png](../Solutions%20Architect/img/Compute%20Service/Screenshot_2024-07-16_at_5.37.45_PM.png)
        
    4. 가속화된 컴퓨팅
        
        Hardware Accelerator(GPU 등) 또는 Coprocessor(수치 연산 코프로세서 등)을 사용함.
        
        ex) 그래픽 처리, 데이터 패친 일치, 부동 소수점 수 계산, 기계학습, 지진 분석, 자율 주행 등
        
        ![Screenshot 2024-07-16 at 5.42.03 PM.png](../Solutions%20Architect/img/Compute%20Service/Screenshot_2024-07-16_at_5.42.03_PM.png)
        
    5. 스토리지 최적화
        
        **대용량 스토리지 볼륨을 탑재**한 스토리지 최적화 인스턴스이며, 로컬 스토리지에서 매우 큰 데이터 세트에 대해 많은 순차적 읽기 쓰기 엑세스를 요구하는 워크로드를 위해 설계.
        
        ex) 데이터 베이스, 분석 워크로드 등
        
    6. HPC 최적화
        
        AWS에서 HPC(고성능 컴퓨팅) 워크로드를 대규모로 실행할 때 최고의 가성비를 제공하도록 제작됨. 대규모의 복잡한 시뮬레이션 및 딥 러닝 워크로드와 같이 고성능 프로세서가 유용한 애플리케이션에 적합
        
        ex) 기후 모델링, 물리학 시뮬레이션, 유전체 분석 등
        
        ![Screenshot 2024-07-16 at 5.50.56 PM.png](../Solutions%20Architect/img/Compute%20Service/Screenshot_2024-07-16_at_5.50.56_PM.png)
        

## 인스턴스 환경 설정

### AWS 리전

고객과 가장 가까운 지역의 리전에 EC2인스턴스를 론칭하는 것이 기본. 하지만 법규에 의해 사용자 데이터의 위치에 제한이 있는 경우 해당 규정에 부합하는 지역의 서버를 사용해야 함.

### VPC

Virtual Private Cloud는 사용이 간편한 AWS 네트워크 생성 및 관리도구, 클라우드 인프라 관리 도구임.

VPC를 추가하더라도 NAT게이트웨이 또는 VPN에 연결하지 않으면 비용이 따로 발생하지 X.

[AWS Site-to-Site VPN란 무엇인가요? - AWS Site-to-Site VPN](https://docs.aws.amazon.com/ko_kr/vpn/latest/s2svpn/VPC_VPN.html)

[예시: 프라이빗 서브넷과 NAT에 서버가 있는 VPC - Amazon Virtual Private Cloud](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/vpc-example-private-subnets-nat.html)

### 테넌시

인스턴스를 생성할 때 테넌시를 설정할 수 있다.

테넌시는 EC2인스턴스가 실행되는 물리적 하드웨어의 소유권과 격리 수준을 지정하는 개념이다. → 보안, 성능 비용관리 측명에서 중요한 역할.

- 공유 테넌시 (shared tenancy) : default
    
    여러 고객의 인스턴스가 동일한 물리적 서버에서 실행될 수 있다. 하지만 드물게 보안 취약점이나 하이퍼바이저의 결함으로 인해 상호작용이 발생할 수 있다. 
    
    취약점으로 인한 사례 : Meltdown 및 Spectre 취약점, VENOM 등
    
- 전용 인스턴스 (dedicated instance)
    
    전용 인스턴스는 특정 고객에게 할당된 물리적 서버에서 실행되며 다른 고객의 인스턴스와 하드웨어를 공유하지 않는다. 공유 테넌시보다 비용이 더 많이 발생하지만 보안 및 규정 준수 요구사항을 충족할 수 있다.
    
- 전용 호스트 (dedicated host)
    
    전용 호스트는 물리적 서버 전체를 제공하며 인스턴스를 실행하는 물리적 서버를 **완전히 제어**할 수 있다.
    

### 인스턴스 동작 환경설정 (부트스트랩)

인스턴스 환경설정 구성에 포함된 사용자 데이터(user data)를 이용하여 부팅 작업 등 EC2의 초기 실행 작업을 변경할 수 있다. 작성한 내용은 리눅스의 경우 `/var/lib/cloud/instance/user-data.txt` 에 저장된다고 한다.

AWS CLI를 사용하는 경우 `--user-data` 로 지정할 수 있다.

```bash
aws ec2 run-instances \
    --image-id ami-xxxxxxxx \
    --count 1 \
    --instance-type t2.micro \
    --key-name MyKeyPair \
    --security-group-ids sg-xxxxxxxx \
    --subnet-id subnet-xxxxxxxx \
    --user-data file://my-user-data-script.sh
```

### 배치 그룹 (Placement Group)

“EC2 > 네트워크 및 보안 > 배치 그룹”에서 인스턴스를 **물리적 하드웨어에 배치하는 방법**을 지정하여 네트워크 성능 또는 가용성을 최적화 할 수 있다.

AWS는 세가지 유형의 플래이스먼트 그룹을 제공한다.

1. Cluster Placement Group
    
    동일한 가용영역(AZ) 내에서 인스턴스를 서로 가깝게 배치하여 네트워크 지연시간을 최소화하고 높은 처리량 제공 → HPC, 빅데이터 분석, 기계학습 등 높은 네트워크 성능이 필요할 때 사용
    
2. Spread Placement Group
    
    데이터 소실 및 서비스 실패와 같은 **위험을 감소시키기 위해** 다수의 AZ사용, **서로 다른 하드웨어 랙**에 인스턴스를 분산 배치. VMware의 DRS와 유사한 기능? → 중요한 소규모 서비스, 고가용성이 필요한 애플리케이션
    
3. Partition Placement Group
    
    연관 인스턴스를 하나의 파티션으로 묶어서 사용할 수 있도록 함. 파티션에 속한 인스턴스는 다른 파티션의 인스턴스와 물리적으로 분리해서 배치 가능. → 대규모 분산 애플리케이션, HDFS, 카산드라 등 장애 도메인 간의 장애 격리가 필요한 워크로드.
    

### 인스턴스 가격 모델

- 온디맨드
- 예약
- 스팟 : 입찰방식

## 인스턴스 생애주기

인스턴스 종료 시 서버 기능 중지, 관련 리소스 AWS 리소스 풀 속으로 재할당.

인스턴스를 종료하면 **1차 스토리지(인스턴스 스토어)**에 저장된 모든 데이터가 삭제된다. 하지만 **EBS 볼륨**을 스토리지로 사용한다면 인스턴스가 종료돼도 볼륨 내 데이터는 유지된다.

시큐리티 정책은 인스턴스 실행 중에도 변경 가능

**인스턴스 타입 변경**으로 컴퓨트, 메모리, 스토리지 용량을 업그레이드 할 수 있음. 이 작업은 먼저 인스턴스를 **중지**시키고 변경 사항을 적용한 뒤 다시 시작.

## 리소스 태그

AWS에서 다수의 리소스를 배포하면, 가종 서비스와 리소스들에 대한 관리가 점점 어려워 진다. EC2 인스턴스와 그에 속한 스토리지, 보안 그룹, Elastic IP 주소 등이 많아질 수록 VPC의 수, 연결 방식 또한 세분화되고 복잡해짐.

관련성 등을 기준으로 나름의 식별 체계를 갖추는 것이 중요해짐. → 일관된 명명 규칙을 지닌 태그를 부여.

- 하나의 태그는 키와 연관 값으로 작성한다.

예를 들어 상용 서버 배포 후 각 서버에 `production-server` 라는 키를 부여 후 대응하는 값으로 `server` `server2` 등으로 태그를 추가해 나갈 수 있다. 보안 그룹의 경우 `security-group1` 등과 같이 값을 부여할 수 있다.

## 서비스 제한 사항

서비스 별로 론칭할 수 있는 인스턴스의 수에 제한이 있음. 개발 리전마다 제한이 존재하기도, 글로벌 리전에 공통적으로 존재하기도 함. 부족하다면 AWS측에 **제한 상향 요청**이 필요.

ex. 리전 당 5개의 VPC 생성. 하나의 계정으로 5000개의 SSH 키 사용 가능.

[AWS service quotas - AWS General Reference](https://docs.aws.amazon.com/general/latest/gr/aws_service_limits.html)

---

## EC2 스토리지 볼륨

### EBS 볼륨

하나의 EC2에는 다수의 Elastic Block Store를 부착할 수 있다. 

볼륨의 성능은 볼륨당 최대 IOPS(Input/Output operations Per Second)수치로 측정한다.

볼륨에는 시간에 따라 변경되는 중요한 데이터가 포함될 수 있으며, Amazon의 EBS Data Lifecycle Manager를 통해 **EBS 기반 스냅샷 및 AMI 생성, 유보, 삭제 등을 자동화할 수 있는 정책**을 작성할 수 있다.

### EBS 볼륨의 타입

[Amazon EBS volume types - Amazon EBS](https://docs.aws.amazon.com/ebs/latest/userguide/ebs-volume-types.html)

1. EBS 프로비전 IOPS SSD
    
    **고도의 I/O작업**이 필요한 경우 이 타입을 사용하는 것이 좋다.
    
    io2 : 64,000 IOPS (16KiB I/O)
    
    io2 Block Express : 256,000 IOPS (16KiB I/O)
    
2. EBS 범용 SSD(General Purpose SSB Volumes)
    
    다양한 트랜잭션 워크로드에 대해 가격과 성능의 균형을 맞추어서 대부분의 워크로드에 적합함.
    
    gp2, gp3’s Max IOPS per volume : 16,000 IOPS (64KiB I/O)
    
    매일 하나의 스냅샷을 생성, 8GB의 부트 드라이브를 사용하는 경우 월간 약 3.29달러의 비용.
    
3. HDD 볼륨
    - 처리량 최적화 HDD(Throughput Optimized HDD) - st1 : 자주 접근되고 처리량이 많은 워크로드를 위한 저렴한 HDD
    - Cold HDD - sc1 : 자주 접근되지 않는 위크로드를 위한 **가장 저렴한 HDD**

**EBS 볼륨 특징**

스냅샷 생성 방식으로 복제 가능. 기존의 스냅샷으로 다른 인스턴스에 부착할 수 있는 볼륨을 만들거나, AMI 생성을 위한 이미지로 변환할 수 있음.

실행 중인 인스턴스를 이용해 직접 AMI 이미지를 생성할 수 있지만 이 경우 데이터 손실 문제를 겪을 수 있으므로 먼저 인스턴스 중지 추천

EBS 저장 데이터 또는 EC2에서 EBS로 보내는 데이터 암호화 가능. 암호화 키는 KMS(AWS Key Management Service)를 통해 사용 및 관리 가능.

### 인스턴스 스토어 볼륨

비지속형 스토리지, 인스턴스를 종료시키면 인스턴스 스토어에 저장된 데이터가 소실. (휘발성)

물리적으로 부착되는 SSD 저장 장치이며, NVMe(Non-Volatile Memory express) 인터페이스로 연결. (고성능)

별도의 비용을 부담하지 않아도 된다. (저비용)

단기적인 목적으로 인스턴스를 시작하는 배포 모델에 적합. 외부에서 데이터를 임포트해서 사용해 내부에 저장된 데이터는 작업 후 삭제돼도 무방한 경우.

- 데이터 처리 작업 : 외부에서 데이터 소스 임포트, 처리 이후 결과를 외부로 내보냄.
- 단기적인 테스트나 개발 작업 : 필요한 데이터를 외부에서 가져와 사용합니다. 작업이 완료되면 인스턴스를 종료하여 데이터를 삭제합니다.

### 결론

인스턴스 재부팅에도 데이터 소실되면 안되거나 AMI에서 생성된 그대로 인스턴스를 사용하는 경우 → **EBS 볼륨**

소실 가능성보다 고속의 데이터 입출력 처리가 중요 → **인스턴스 스토어**

읽기/쓰기 작업이 고속의 수준으로 할 필요가 없다면 → **S3** 도 좋은 대안

---

## Auto Scaling

론치 환경설청을 이용하는 방법과 론치 템플릿(시작 템플릿)을 이용하는 방법이 있는데 AWS는 공식적으로 **론치 템플릿 사용을 권장**하고 있음.

**론치 환경설정**

- 론치 환경설정은 EC2 Auto Scaling에서만 사용 가능
- 론치 환경설정만 가지고 직접 인스턴스를 론칭할 수 없음.
    - Auto Scaling 그룹과 함께 사용되어 특정 조건이 발생했을 때 자동으로 인스턴스를 생성하고 관리.
- 한번 론치 환경설정을 생성하면 수정 불가. 새 론치 환경설정을 생성해야 함.

**론치 템플릿**

- Auto Scaling 작업 뿐만 아니라, EC2 인스턴스 사본 생성, 스팟 플릿 생성의 목적으로도 사용 가능함.
- 버전 기능을 제공하여 생성 후에도 내용 변경이 가능함.

### Auto Scaling 그룹

**Auto Scaling그룹의 주요 기능**

- 자동 확장 및 축소
- 건강 상태 확인
- 다양한 조정 정책
- 최소, 최대 및 희망 용량 설정

Auto Scaling이 관리하는 EC2 인스턴스 그룹, Auto Scaling그룹 생성에 앞서 론치 템플릿을 생성해야함. 

Auto Scaling 그룹에서 인스턴스에 유입되는 트래픽을 분산시키려면 로드밸런서를 설정하면 된다. Auto Scaling그룹 생성 시 로드 밸런서 타겟 그룹에 연결하면 된다.

- 타겟 그룹 : 로드 밸런서가 트래픽을 라우팅할 대상인 EC2 인스턴스 주소, IP주소, Lambda 함수를 묶어 관리하는 단위.

**애플리케이션 인스턴스에 대한 헬스 체크**

- Auto Scaling의 인스턴스 헬스에 대한 판단 기준은 EC2 헬스 체크를 따르며 이를 통해 메모리 고갈, 파일 시스템 오류, 네트워크 연결 오류, 시작 환경설정 오류, 시스템 문제 여부 등을 확인할 수 있다.
    - 이 경우 컴퓨팅 자원 등에 대한 인스턴스의 헬스체크는 가능하지만 애플리케이션의 상태에 대해서는 헬스체크가 불가능
- ALB(Application Load Balancer)는 애플리케이션의 특정 경로에 요청을 보내 응답코드를 받아 애플리케이션의 정상 작동 여부를 확인할 수 있다.

**스케일링 정책 설정**

Auto Scaling그룹 생성 시 몇 개의 인스턴스를 프로비전하고 실행할 것인지 지정해야 함.

- 최소 용량 : 인스턴스 수가 최소 크기 이하로 내려가지 않도록 함.
- 최대 용량 : 인스턴스 수가 최대 크기 이상이 되지 않도록 함.
- 희망 용량 : 선택적으로 입력할 수 있으며, 해당 값이 맞추어 인스턴스를 추가 또는 종료시킴. 웹 콘솔에서는 그룹 사이즈라고 부름.

### Auto Scaling 옵션

그룹 생성 후 최소 또는 희망 용량으로 유지되도록 내버려 두는 방법도 있지만 다양한 Scaling 옵션이 있음.

**스케일링 정책**

- 수동 스케일링 정책 : 사용자가 직접 AWS Management Console, AWS CLI 등을 통하여 직접 Auto Scaling 그룹의 인스턴스 수를 조정하는 방식.
- 동적 스케일링 정책
    - 단순 스케일링 정책 : CPU 사용률이 70%를 초과하면 인스턴스를 2개 추가 등 , 특정 조건이 충족되면 미리 정의된 조정 동작을 수행합니다
    - 단계별 스케일링 정책 : CPU 사용률이 70% 초과 시 인스턴스를 2개 추가, 85% 초과 시 4개 추가 등, 조건의 임계값을 여러 단계로 설정하여 각 단계마다 다른 조정 동작을 수행합니다.
    - 목표 추적 정책 : CPU 사용률 50% 유지 등 특정 지표를 목표로 설정하여 그 목표를 유지하기 위해 인스턴스 수를 자동으로 조정합니다.
- 스케줄링된 작업 : 특정 시간에 Auto Scaling 그룹의 인스턴스 수를 조정하는 작업을 예약할 수 있습니다. 주기적인 스케일링 작업을 예약할 때 사용됩니다.

**스케일링 조정 타입**

희망 용량이 변화되어도 최대 용량을 벗어나지 않음.

- ChangeInCapacity : 지정 숫자만큼 희망 용량을 증가시킴. 예를 들어 희망 용량을 4로 설정한 뒤 지정 숫자가 2라면 4에서 6이 됨.
- ExactCapacity : 현재 값에 상관 없이 용량을 지정 숫자로 증가시킴. 예를 들어 현재 희망 용량이 4이고, 지정 숫자가 6이라면 희망 용량을 4에서 6으로 증가시킴.
- PercentChangeInCapacity : 현재 용량의 비율을 기준으로 증가시킴. 예를 들어 희망용량이 4인데 50%를 지정 비율로 설정하면 희망 용량이 6이 된다.

Auto Scaling 조정 작업 종류 후에 관련 정책을 다시 실행하기 전 **휴식기가 있음**. 기본 휴식기는 300초이지만 0으로 설정해서 휴식기를 갖지 않도록 할 수도 있음.

---

## AWS Systems Manager

AWS 리소스 및 On-premise Server의 작업 관리를 수동이나 자동으로 할 수 있다. EC2 인스턴스의 패키지 업그레이드, 설치 소프트웨어 목록 생성, 새 애플리케이션 설치 등의 업무를 돕고 EBS 스냅샷을 이용한 AMI 이미지 생성, IAM 인스턴스 프로파일 부착은 물론 S3 버킷에 대한 퍼블릭 접근 차단 등의 업무도 수행한다.

주요 기능은 액션과 인사이트로 나뉜다

- 액션 : System Manager에서 직접 수행할 수 있는 작업 및 명령
    - 자동화 액션 (Automation) : 관리 작업 자동화
    - 명령 액션 (Run Command) : 원격 명령 실행
    - 정책 액션
        - 세션 매니저 : 안전한 원격 접속
        - 패치 메니저 : 자동 패치 관리
        - 스테이트 매니저 : 구성 상태 관리
- 인사이트 : System Manager가 제공하는 모니터링 분석도구 → 태그 키와 밸류를 이용해 정의한 리소스 그룹에 따라 카테고리화된다.
    - 빌트인 인사이트 : Systems Manager가 기본적으로 제공하는 모니터링 내역
        - AWS Config Compliance
        - CloudTrail Events
        - Personal Health Dashboard
    - 인벤토리 (AWS Systems Manager Inventory) : 구성 데이터 수집 및 관리
    - 컴플라이언스 (Compliance) : 규정 준수 상태 모니터링

1. **Automation**
    - AWS 리소스에 대해 일괄적으로 작업을 수행할 수 있다. (다수의 EC2 인스턴스 재시작, ClouldFormation 스택 업데이트, AMI 패치)
    - 필요한 상황과 시점에 맞춰 단계별로 처리되도록 할 수 있으며 한번에 몇개의 리소스를 처리 대상으로 삼을지 숫자로 또는 퍼센트로 지정할 수 있음.
    
    <aside>
    💡 CloudFormation
    AWS 리소스를 프로비저닝하고 관리할 수 있는 서비스로, 인프라를 코드로 관리(IaC)할 수 있게 해줍니다. CloudFormation 템플릿을 사용하여 AWS 리소스를 정의하고 프로비저닝합니다.
    
    CloudFormation 스택 : 하나의 CloudFormation 템플릿으로 생성된 AWS 리소스의 모음입니다.
    
    </aside>
    
2. **Run Command**
    - 주로 Linux, Windows 인스턴스에 명령을 실행하는 기능. SSH나 RDP 자격증명 없이 로그인하여 커스텀 스크립트 실행을 위해 서드파티 도구를 실행할 수도 있다. Systems Manger는 인스턴스와 관련된 작업을 할 수 있는 권한이 없어 AmazonEC2RoleforSSM 정책에서 인스턴스 프로파일 롤을 추가해야한다.
    - 다양한 명령 문서를 제공하는데 이중 AWS-InstallApplication 문서는 윈도우에 소프트웨어를 설치할 수 있으며 AWS-RunShellScript문서는 리눅스 인스턴스에서 임의의 쉘 스크립트를 실행할 수 있다.
3. **Session Manager**
    - 보안 그룹, NACL(Network Access Control List)에서 인바운드 포트 개방 없이, 혹은 서브넷에 인스턴스를 두지 않고 인스턴스에 대한 Bash나 PowerShell등 터미널이나 브라우저 기반 세션을 통해 인스턴스에 접근할 수 있다.
    - 로컬에 Session Manager 플러그인을 설치해 AWS CLI로 접속하거나  또는 웹 콘솔에서 접속할 수 있다.
    - Session Manager SDK를 이용하여 인스턴스에 연결되는 커스텀 애플리케이션 개발을 돕는 라이브러리를 사용할 수 있다.
    - TLS 1.2로 보호되며 모든 로드는 CloudTrail에 저장되고 세션에서 실행하는 모든 명령은 S3 버킷에 저장된다.
4. **Patch Manager**
    - 패치 자동화 도구로 정기적인 패치 관리, 보안 취약점 대응 등에 사용된다.
    - 패치 대상은 태그 등을 기준으로 선택할 수 있으며 패치 그룹을 생성해서 작업을 진행할 수 있다. (패치 그룹은 Patch Group 태그 키를 가진 인스턴스의 모음이다. 키를 Patch Group, 값을 Webservers라고 태그를 설정하여 Webservers라는 패치 그룹에 인스턴스를 포함 시킬 수 있다.)
    - 패치 베이스라인을 통해 패치 작업을 수행할 대상을 정의한다. (패치 베이스라인 : 패치를 적용할 소프트웨어의 목록과 규칙을 정의하는 설정. 이를 통해 어떤 패치를 적용할지, 승인할 패치를 결정할 수 있음.)
        - 베이스라인을 통해 보안 수준, 민감성, 중요성, 필요성 등을 기준으로 패치 소프트웨어 분류.
        - 패치가 릴리즈 된 후 7일 후 자동으로 승인 및 설치되며 이를 “자동 승인 지연”이라고 함. → 이를 통해 일정 기간 동안 테스트를 거친 후 자동으로 승인되도록 할 수 있음.
    - 패치 작업 수행을 위하여 AWS-RunPatchBaseline 도큐먼트를 실행.
5. **State Manger**
    - 우리가 정의한 방식대로 소프트웨어를 가져오고 환경을 설정하는 환경설정 도구.
    - 스테이트 매니저는 인스턴스에 대해 일회성 또는 미리 정해진 일정에 따라, 자동으로 명령 및 정책 도큐먼트를 실행.
    - 사용하기 위해 실행할 명령 도큐먼트를 정의한 **연계객체 생성** → 전달할 파라미터, 타겟 인스턴스, 스케줄 설정 → 온라인으로 즉시 실행된 뒤 이후 스케줄에 따라 실행.
    - 같이 사용할 수 있는 **정책 도큐먼트로 AWS-GatherSoftwareInventory**가 있음
        - 인스턴스로부터 소프트웨어 인벤토리 등 특정 메타데이터를 수집하도록 함. 메타데이터는 네트워크 환경설정, 파일 정보, CPU 정보, 윈도우의 경우 레지스트리 값 등이 포함되어 있음.
    
6. **Built in Insight**
    1. AWS Config Compliance
        - AWS Config는 AWS 리소스의 구성을 지속적으로 모니터링하고, 사용자 정의 규칙을 통해 리소스의 규정 준수 상태를 평가합니다.
        - AWS Config 규칙 및 리소스별 **규정 준수 상태 확인**.
        - 리소스 그룹의 전체 리소스 수 및 AWS Config가 추적한 구성 변경 이력 제공.
    2. CloudTrail Events
        - AWS CloudTrail은 AWS 계정의 **API 호출을 기록**하여 AWS 리소스의 활동을 모니터링합니다.
        - 리소스 그룹, 리소스 타입, 해당 리소스에 대해 CloudTrail이 마지막으로 기록한 이벤트를 제공.
    3. Personal Health Dashboard
        - AWS Personal Health Dashboard는 사용자의 AWS 리소스에 영향을 미칠 수 있는 서비스 이벤트와 문제를 모니터링하고 경고를 제공합니다.
        - 리소스에 영향을 미칠 수 있는 각종 이슈에 대한 경고 제공.
        - AWS 서비스의 상태와 이벤트에 대한 실시간 업데이트.
    4. Trusted Advisor Recommendations 
        - AWS 계정의 리소스를 모니터링하고 최적화, 보안 강화, 비용 절감, 성능 개선 및 장애 복구를 위한 **권장 사항을 제공하는 서비스**입니다.
        - 비용 최적화, 보안 개선, 성능, 장애복구, 서비스 제한 준수
7. **Inventory**
    - OS이름 및 버전, 애플리케이션 및 파일네임, 버전, 사이즈, IP 및 MAC주소 등 네트워크 환경설정, 윈도우 업데이트, 롤, 서비스, 레지스트리 벨류, CPU 모델, 코어, 스피드 등 인스턴스의 데이터를 수집한다.
    - AWS-GatherSoftwareInventory 정책 도큐먼트를 실행한다.
    - 계정 내 모든 인스턴스를 선택하거나 태그를 기준으로 인스턴스를 선택할 수 있다. 계정 내 모든 인스턴스를 선택한 경우 글로벌 인벤토리 어소시에이션이라 한다. 새로운 인스턴스는 자동으로 해당 인벤토리에 추가된다.
    - 인벤토리 수집작업은 최소 30분마다 이루어진다.
    - 다른 리전 또는 계정의 인스턴스로부터 메타데이터를 수집하려는 경우, 리전별로 **Resource Data Sync**의 환경을 설정해서 모든 인벤토리 데이터가 하나의 **S3버킷에 저장되도록** 한다.
8. **Compliance**
    - 정한 환경설정 규칙이 인스턴스의 패치 및 상태관리에 어떻게 적용되고 있는지 보여준다.
    - 패치 컴플라이언스는 패치 베이스라인이 적용된 인스턴스의 수 및 설치된 패치의 세부 정보를 보여준다.
    - 어소시에이션 컴플라이언스는 패치 작업이 성공적으로 실행된 인스턴스의 수를 보여준다.

---

## 컨테이너 실행하기

컨테이너란 워크로드의 실행 및 연결을 위한 호스팅 소프트웨어. AWS는 **ECS**, **EKS** 등 두 가지의 상용화된 컨테이너 서비스 제공. **ECR** 이라는 컨테이너 이미지 저장소(레지스트리 서비스) 제공

컨테이너 기반의 컴퓨트 모델은 자체 커널이 아닌, 호스트의 커널을 공유 → 기존의 인스턴스 방식보다 높은 효율성

컨테이너에서는 바이너리 이미지 생성을 위한 텍스트 파일만 관리하면 된다. (ex. Dockerfile)

장점 중 하나는 컴퓨트 리소스 실행을 스크립트화하여 효율적으로 처리 가능

- ECS
    
    컨테이너 수가 많아지면 적절한 자원 할당 및 네트워크 설정 등의 작업이 복잡해짐 → ECS와 같은 오케스트레이션의 중요성이 대두.
    
    애플리케이션 정의, 적절한 컨테이너 이미지 선택, 리소스 환경 구성, 제반 요소를 관리 가능
    
    대규모 컨테이너 클러스터  실행을 위한 서비스이며 인스턴스, 스토리지, 네트워크 리소스의 프로비저닝을 관리하며 컨테이너 생애 주기동안 컨테이너의 모니터링 및 관리작업을 지원
    
    - Amazon ECS Anywhere : ECS 플랫폼을 **온프레미스 인프라로 확장할 수 있도록 지원**. 동일한 API와 도구를 이용해 사용. → 하이브리드 클라우드 환경에 적합. 온프레미스에만 사용해도 비용 청구된다.
        - 컨테이너를 호스팅하려는 로컬 서버에 활성화 키를 이용해 ECS 및 SSM 에이전트의 설치 및 실행이 필요함
- EKS
    
    ECS와 대체로 비슷하지만 특정 컨테이너 플랫폼에 구애받지 않고 사용할 수 있음.
    
    - Amazon EKS Anywhere 존재
    - Amazon EKS Distro : **EKS 호환 환경설정을 무료로 다운로드 가능**, 이를 통해 긴밀하게 버전 컨트롤 및 환경구성과 관련된 의존성 요소 관리 가능 → 복잡해질 수 있는 쿠버네티스 운영 환경을 좀 더 체계적이고 표준화된 방식으로 업데이트 및 관리 가능
- 기타
    - AWS Fargate : ECS, EKS플랫폼이 **안전하게 격리된 환경에서 실행될 수 있도록 도움**.
    - ECR : 관리형 도커 컨테이너 레지스트리 서비스. 도커 컨테이너 이미지의 저장, 관리, 배포 등 각종 업무를 간소화
        
        IAM과 컨테이너 서비스를 통합하여 각 컨테이너 저장소에 대한 리소스 수준 관리가 가능해짐.
        

---